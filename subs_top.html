{% extends "base.html" %} {% block content %}
<!-- Modern Submissions Dashboard -->
<div class="submissions-hero glass-panel p-6 mb-6">
    <div class="flex items-center justify-between mb-4">
        <div class="hero-content">
            <h1 class="text-2xl font-bold tracking-tight bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                Submission Pipeline
            </h1>
            <p class="text-sm opacity-75 mt-1">
                Intelligent prioritization and advanced filtering for maximum efficiency
            </p>
        </div>
        <div class="pipeline-stats flex items-center gap-4">
            <div class="stat-bubble">
                <div class="stat-value" id="subs_count">—</div>
                <div class="stat-label">Total</div>
            </div>
            <div class="stat-bubble target">
                <div class="stat-value" id="target_count">—</div>
                <div class="stat-label">Targets</div>
            </div>
            <div class="stat-bubble">
                <div class="stat-value" id="completion_rate">—%</div>
                <div class="stat-label">Processed</div>
            </div>
        </div>
    </div>
    
    <!-- Real-time Pipeline Status -->
    <div class="pipeline-status">
        <div class="status-bar">
            <div class="status-segment target" style="width: 25%"></div>
            <div class="status-segment in" style="width: 45%"></div>
            <div class="status-segment out" style="width: 30%"></div>
        </div>
        <div class="status-legend">
            <span class="legend-item target">🎯 Target (25%)</span>
            <span class="legend-item in">✅ In-Appetite (45%)</span>
            <span class="legend-item out">❌ Out-of-Appetite (30%)</span>
        </div>
    </div>
</div>
    
<!-- Smart Filtering System -->
<div class="smart-filters glass-panel p-6 mb-6">
    <div class="filter-header">
        <div class="flex items-center justify-between mb-4">
            <div class="filter-title-section">
                <h3 class="text-lg font-bold flex items-center gap-2">
                    <span class="filter-icon">🔍</span>
                    Smart Filters
                </h3>
                <p class="text-sm opacity-75">Intelligent filtering with saved presets and AI assistance</p>
            </div>
            <div class="filter-actions">
                <button id="save_filter_preset" class="control-btn">
                    <span class="icon">💾</span>
                    Save Preset
                </button>
                <button id="clear_all_filters" class="control-btn">
                    <span class="icon">🗑️</span>
                    Clear All
                </button>
            </div>
        </div>
    </div>

    <!-- Quick Filter Presets -->
    <div class="filter-presets mb-6">
        <div class="preset-grid">
            <button class="filter-preset-card active" data-preset="all">
                <div class="preset-icon">📋</div>
                <div class="preset-content">
                    <div class="preset-title">All Submissions</div>
                    <div class="preset-desc">Complete pipeline view</div>
                </div>
                <div class="preset-count" id="preset_all_count">—</div>
            </button>
            
            <button class="filter-preset-card" data-preset="targets">
                <div class="preset-icon">🎯</div>
                <div class="preset-content">
                    <div class="preset-title">Priority Targets</div>
                    <div class="preset-desc">High-value opportunities</div>
                </div>
                <div class="preset-count" id="preset_targets_count">—</div>
            </button>
            
            <button class="filter-preset-card" data-preset="in-appetite">
                <div class="preset-icon">✅</div>
                <div class="preset-content">
                    <div class="preset-title">In-Appetite</div>
                    <div class="preset-desc">Ready for review</div>
                </div>
                <div class="preset-count" id="preset_in_count">—</div>
            </button>
            
            <button class="filter-preset-card" data-preset="high-value">
                <div class="preset-icon">💎</div>
                <div class="preset-content">
                    <div class="preset-title">High Value</div>
                    <div class="preset-desc">$100K+ premium</div>
                </div>
                <div class="preset-count" id="preset_high_count">—</div>
            </button>
            
            <button class="filter-preset-card" data-preset="new-business">
                <div class="preset-icon">🆕</div>
                <div class="preset-content">
                    <div class="preset-title">New Business</div>
                    <div class="preset-desc">Fresh opportunities</div>
                </div>
                <div class="preset-count" id="preset_new_count">—</div>
            </button>
            
            <button class="filter-preset-card" data-preset="recent">
                <div class="preset-icon">⏰</div>
                <div class="preset-content">
                    <div class="preset-title">Recent</div>
                    <div class="preset-desc">Last 7 days</div>
                </div>
                <div class="preset-count" id="preset_recent_count">—</div>
            </button>
        </div>
    </div>

    <!-- Advanced Filters -->
    <div class="advanced-filters">
        <div class="filters-toggle">
            <button id="toggle_advanced" class="toggle-btn">
                <span class="toggle-icon">⚙️</span>
                <span class="toggle-text">Advanced Filters</span>
                <span class="toggle-arrow">↓</span>
            </button>
        </div>
        
        <div id="advanced_filter_panel" class="filter-panel hidden">
            <div class="filter-grid">
                <div class="filter-group">
                    <label class="filter-label">State/Region</label>
                    <div class="filter-input-enhanced">
                        <span class="input-icon">🗺️</span>
                        <input id="f_state" class="filter-input" placeholder="e.g., CA, FL, TX" />
                    </div>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Appetite Status</label>
                    <select id="f_status" class="filter-select">
                        <option value="">Any Status</option>
                        <option value="TARGET">🎯 Target</option>
                        <option value="IN">✅ In-Appetite</option>
                        <option value="OUT">❌ Out-of-Appetite</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Analysis Mode</label>
                    <select id="f_mode" class="filter-select">
                        <option value="" disabled selected>Loading modes…</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Premium Range</label>
                    <div class="range-inputs">
                        <input id="f_min" class="range-input" type="number" placeholder="Min (e.g., 50,000)" />
                        <span class="range-separator">to</span>
                        <input id="f_max" class="range-input" type="number" placeholder="Max (e.g., 175,000)" />
                    </div>
                </div>
                
                <div class="filter-group span-2">
                    <label class="filter-label">Search Accounts</label>
                    <div class="search-input-enhanced">
                        <span class="input-icon">🔍</span>
                        <input id="f_q" class="search-input" placeholder="Search by account name, broker, or keywords..." />
                        <button class="search-clear hidden" id="clear_search">×</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="flex items-center justify-between mt-4">
        <div class="flex items-center gap-2">
            <button id="btn_apply" class="quick-action primary">Apply Filters</button>
            <button id="btn_clear" class="quick-action">Clear All</button>
            <button id="btn_save_filter" class="quick-action">💾 Save Filter</button>
        </div>
        <div class="flex items-center gap-2">
            <input id="nlq" class="inp w-72" placeholder="Ask: 'Show targets in CA over $100k premium'" />
            <button id="btn_nlq" class="quick-action">Ask AI</button>
            <button id="btn_refresh" class="quick-action">🔄 Refresh</button>
            <button id="btn_export" class="quick-action">📊 Export</button>
        </div>
    </div>
</div>

<!-- Enhanced Submissions Table -->
<div class="submissions-table-panel card p-0">
    <div class="table-header bg-gradient-to-r from-gray-50/50 to-gray-100/50 p-4 border-b border-white/10">
        <div class="flex items-center justify-between">
            <div class="table-title-section">
                <h3 class="text-lg font-semibold text-indigo-400 mb-1">📊 Submissions Analysis</h3>
                <p class="text-sm text-gray-400">Advanced filtering and bulk actions</p>
            </div>
            
            <div class="table-controls flex items-center gap-3">
                <div class="view-options">
                    <button class="control-btn active" data-view="table">
                        <i class="fas fa-table"></i>
                        Table
                    </button>
                    <button class="control-btn" data-view="cards">
                        <i class="fas fa-th-large"></i>
                        Cards
                    </button>
                </div>
                
                <div class="table-actions">
                    <button class="control-btn" id="bulk-actions-btn">
                        <i class="fas fa-tasks"></i>
                        Bulk Actions
                    </button>
                    <button class="control-btn" id="export-submissions-btn">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                    <button class="control-btn" id="columns-btn">
                        <i class="fas fa-columns"></i>
                        Columns
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div id="table-loading" class="loading-skeleton hidden">
        <div class="table-skeleton">
            <div class="skeleton-row" style="width: 100%; height: 3rem;"></div>
            <div class="skeleton-row" style="width: 95%; height: 2.5rem;"></div>
            <div class="skeleton-row" style="width: 98%; height: 2.5rem;"></div>
            <div class="skeleton-row" style="width: 92%; height: 2.5rem;"></div>
            <div class="skeleton-row" style="width: 97%; height: 2.5rem;"></div>
        </div>
    </div>

    <!-- Table Container -->
    <div class="table-container overflow-x-auto">
        <!-- Enhanced Table -->
        <div class="overflow-x-auto">
            <table class="enhanced-submissions-table w-full text-sm">
            <thead class="border-b border-white border-opacity-10">
                <tr>
                    <th class="checkbox-col py-4 px-3">
                        <input type="checkbox" id="select-all" class="table-checkbox">
                    </th>
                    <th class="th th-sort sortable text-left py-4 px-6" data-key="priority_score">
                        <div class="th-content">
                            <i class="fas fa-star th-icon"></i>
                            Priority
                            <i class="fas fa-sort sort-icon arrow"></i>
                        </div>
                    </th>
                    <th class="th th-sort sortable text-left py-4 px-4" data-key="appetite_status">
                        <div class="th-content">
                            <i class="fas fa-traffic-light th-icon"></i>
                            Status
                            <i class="fas fa-sort sort-icon arrow"></i>
                        </div>
                    </th>
                    <th class="th th-sort sortable text-left py-4 px-4" data-key="account_name">
                        <div class="th-content">
                            <i class="fas fa-building th-icon"></i>
                            Account
                            <i class="fas fa-sort sort-icon arrow"></i>
                        </div>
                    </th>
                    <th class="th th-sort sortable text-left py-4 px-4" data-key="primary_risk_state">
                        <div class="th-content">
                            <i class="fas fa-map-marker-alt th-icon"></i>
                            State
                            <i class="fas fa-sort sort-icon arrow"></i>
                        </div>
                    </th>
                    <th class="th th-sort sortable text-left py-4 px-4" data-key="total_premium">
                        <div class="th-content">
                            <i class="fas fa-money-bill-wave th-icon"></i>
                            Premium
                            <i class="fas fa-sort sort-icon arrow"></i>
                        </div>
                    </th>
                    <th class="th th-sort sortable text-left py-4 px-4" data-key="tiv">
                        <div class="th-content">
                            <i class="fas fa-dollar-sign th-icon"></i>
                            TIV
                            <i class="fas fa-sort sort-icon arrow"></i>
                        </div>
                    </th>
                    <th class="th th-sort sortable text-left py-4 px-4" data-key="winnability">
                        <div class="th-content">
                            <i class="fas fa-percentage th-icon"></i>
                            Win%
                            <i class="fas fa-sort sort-icon arrow"></i>
                        </div>
                    </th>
                    <th class="th actions-col text-left py-4 px-4">
                        <div class="th-content">
                            <i class="fas fa-cog th-icon"></i>
                            Actions
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody id="tbody">
                <!-- Submissions will be loaded here -->
            </tbody>
        </table>

        <!-- Empty State -->
        <div id="empty-state" class="empty-state hidden text-center py-12">
            <div class="empty-icon text-4xl mb-3">
                <i class="fas fa-search"></i>
            </div>
            <h3 class="text-lg font-semibold mb-2">No submissions found</h3>
            <p class="text-sm opacity-75 mb-4">Try adjusting your filters or search criteria</p>
            <button class="control-btn" onclick="clearAllFilters()">
                <i class="fas fa-times"></i>
                Clear Filters
            </button>
        </div>
    </div>

    <!-- Enhanced Pagination -->
    <div class="table-footer bg-gradient-to-r from-gray-50/30 to-gray-100/30 p-4 border-t border-white/10">
        <div class="flex items-center justify-between">
            <div class="table-info">
                <div class="pagination-info">
                    Showing <span id="page-start" class="font-semibold text-indigo-400">1</span>-<span id="page-end" class="font-semibold text-indigo-400">25</span> 
                    of <span id="total-count" class="font-semibold text-indigo-400">0</span> submissions
                </div>
                <div class="selected-info hidden">
                    <span id="selected-count" class="font-semibold text-emerald-400">0</span> selected
                </div>
            </div>
            
            <div class="pagination-controls flex items-center gap-2">
                <div class="page-size-selector">
                    <select id="page-size" class="filter-select">
                        <option value="25">25 per page</option>
                        <option value="50">50 per page</option>
                        <option value="100">100 per page</option>
                    </select>
                </div>
                
                <div class="pagination-buttons">
                    <button id="first-page" class="pagination-btn" disabled>
                        <i class="fas fa-angle-double-left"></i>
