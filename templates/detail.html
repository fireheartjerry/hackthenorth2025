{% extends "base.html" %} {% block content %} {% if not item %}
<div class="text-sm opacity-80">Not found.</div>
{% else %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 glass-panel">
        <div class="flex items-center justify-between">
            <div>
                <div class="text-xl font-semibold">{{ item.account_name }}</div>
                <div class="text-xs opacity-70">ID {{ item.id }}</div>
            </div>
            <div class="flex items-center gap-2">
                <span
                    class="pill {% if item.appetite_status=='TARGET' %}pill-indigo{% elif item.appetite_status=='IN' %}pill-emerald{% else %}pill-rose{% endif %}"
                >
                    {{ item.appetite_status }}
                </span>
                <span class="chip"
                    >Score {{ '%.2f'|format(item.priority_score or 0) }}</span
                >
            </div>
        </div>
        <div class="mt-4 grid grid-cols-2 md:grid-cols-3 gap-3 text-sm">
            <div class="kv">
                <span>State</span><b>{{ item.primary_risk_state }}</b>
            </div>
            <div class="kv">
                <span>LOB</span><b>{{ item.line_of_business }}</b>
            </div>
            <div class="kv">
                <span>Premium</span
                ><b>${{ '%.0f'|format(item.total_premium or 0) }}</b>
            </div>
            <div class="kv">
                <span>TIV</span><b>${{ '%.0f'|format(item.tiv or 0) }}</b>
            </div>
            <div class="kv">
                <span>Winnability</span
                ><b>
                    {% if item.winnability is number %} {% if item.winnability>1
                    %}{{ '%.0f'|format(item.winnability) }}%{% else %}{{
                    '%.0f'|format((item.winnability or 0)*100) }}%{% endif %} {%
                    else %}-{% endif %}
                </b>
            </div>
            <div class="kv">
                <span>Oldest Building</span><b>{{ item.oldest_building }}</b>
            </div>
            <div class="kv">
                <span>Construction</span><b>{{ item.construction_type }}</b>
            </div>
            <div class="kv">
                <span>Effective</span><b>{{ item.effective_date or '-' }}</b>
            </div>
            <div class="kv">
                <span>Expiration</span><b>{{ item.expiration_date or '-' }}</b>
            </div>
        </div>
        <div class="mt-6">
            <div class="text-sm opacity-70">Reasons</div>
            <div class="mt-2 text-sm">
                {% if item.appetite_reasons and item.appetite_reasons|length>0
                %}
                <ul class="list-disc pl-6">
                    {% for r in item.appetite_reasons %}
                    <li>{{ r }}</li>
                    {% endfor %}
                </ul>
                {% else %}
                <div class="opacity-80">Meets appetite</div>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="glass-panel">
        <div class="text-lg font-semibold">AI Rationale</div>
        <button id="btn_explain" class="btn mt-3 w-full hover-glow">
            Explain this submission
        </button>
        <div id="ai_text" class="mt-3 text-sm opacity-90"></div>
    </div>
</div>
<script>
    document.getElementById("btn_explain").onclick = () => {
        const params = new URLSearchParams(window.location.search);
        const mode = params.get("mode");
        const url = mode
            ? `/api/explain/{{ item.id }}?mode=${encodeURIComponent(mode)}`
            : `/api/explain/{{ item.id }}`;
        fetch(url, { method: "POST" })
            .then((r) => r.json())
            .then((j) => {
                document.getElementById("ai_text").innerText = j.ok
                    ? j.explanation
                    : "Error";
            });
    };
</script>
{% endif %} {% endblock %}
